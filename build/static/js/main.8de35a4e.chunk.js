(this["webpackJsonpvote-frontend"]=this["webpackJsonpvote-frontend"]||[]).push([[0],{163:function(e,t,a){},192:function(e,t,a){e.exports=a(363)},213:function(e,t,a){},321:function(e,t,a){},335:function(e,t,a){},336:function(e,t,a){},362:function(e,t,a){},363:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(24),l=a.n(c),o=a(29),s=a(34),i=a(47),u=a(35),m=a.n(u),p=a(366),d=a(371),f=a(370),E=a(72);a(147),a(213);function g(){var e=Object(n.useRef)(),t=Object(s.f)(),a=p.a.useForm(),c=Object(o.a)(a,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{layout:"horizontal",className:"login-form",initialValues:{remember:!0},form:c},r.a.createElement(p.a.Item,{name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}]},r.a.createElement(f.a,{placeholder:"\u7528\u6237\u540d"})),r.a.createElement(p.a.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}]},r.a.createElement(f.a.Password,{visibilityToggle:!1,placeholder:"\u5bc6\u7801"})),r.a.createElement(p.a.Item,{name:"captcha",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"}],className:"captchaInput"},r.a.createElement(f.a,{placeholder:"\u9a8c\u8bc1\u7801(\u533a\u5206\u5927\u5c0f\u5199)"})),r.a.createElement("img",{className:"captcha",src:"/captcha?t=".concat(Date.now()),alt:"captcha",ref:e,onClick:function(){e.current.src="/captcha?t=".concat(Date.now())}}),r.a.createElement(p.a.Item,null,r.a.createElement(E.a,{type:"primary",htmlType:"submit",onClick:function(a){a.preventDefault(),m.a.post("/vote/login",c.getFieldsValue(["name","password","captcha"])).then((function(e){d.b.success("\u767b\u5f55\u6210\u529f"),t.push("/")}),(function(t){d.b.warning(t.response.data.msg.toString()),2===t.response.data.code?(e.current.src="/captcha?t=".concat(Date.now()),c.resetFields(["captcha"])):0===t.response.data.code&&(c.resetFields(["name","password","captcha"]),e.current.src="/captcha?t=".concat(Date.now()))}))},className:"login-form-button"},"\u767b\u5f55"),r.a.createElement(i.b,{to:"/signup"},"\u6ca1\u6709\u8d26\u53f7\uff1f\u6ce8\u518c\u4e00\u4e2a\u5427"))))}var v=a(367);a(321);function h(){var e=Object(s.f)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{style:{width:300},className:"card"},r.a.createElement(E.a,{onClick:function(){e.push("/create-single-vote")},className:"button",size:"large"},"\u65b0\u5efa\u5355\u9009"),r.a.createElement(E.a,{onClick:function(){e.push("/create-multiple-vote")},className:"button",size:"large"},"\u65b0\u5efa\u591a\u9009"),r.a.createElement(E.a,{onClick:function(){e.push("/my")},className:"button",size:"large"},"\u6211\u7684"),r.a.createElement(E.a,{onClick:function(){m.a.get("/vote/logout").then((function(){e.push("/login")}))},className:"button",size:"large"},"\u767b\u51fa")))}var b=a(89),O=a.n(b),j=a(57),w=a(117),I=a(365),y=a(373),N=(a(163),a(56)),k=a.n(N);function S(){var e=Object(n.useState)(["",""]),t=Object(o.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)({}),i=Object(o.a)(l,2),u=i[0],g=i[1],v=Object(n.useState)(!1),h=Object(o.a)(v,2),b=h[0],N=h[1],S=Object(s.f)(),C=p.a.useForm(),F=Object(o.a)(C,1)[0];function D(){return(D=Object(w.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:F.getFieldValue("title"),description:F.getFieldValue("description"),options:a,ddl:u._d.toISOString(),anonymous:b?1:0,multiple:0},e.prev=1,e.next=4,m.a.post("/vote/createvote",t);case 4:n=e.sent,d.b.success("\u521b\u5efa\u6210\u529f"),S.push("/vote/".concat(n.data.voteId)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),d.b.warning(e.t0.response.data.msg.toString());case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}return r.a.createElement("div",{className:"wrapper"},r.a.createElement("h3",null,"\u521b\u5efa\u5355\u9009\u6295\u7968"),r.a.createElement(p.a,{form:F,layout:"horizontal"},r.a.createElement(p.a.Item,{name:"title",rules:[{required:!0,message:"\u6295\u7968\u6807\u9898\u5fc5\u586b"}]},r.a.createElement(f.a,{placeholder:"\u6295\u7968\u6807\u9898"})),r.a.createElement(p.a.Item,{name:"description"},r.a.createElement(f.a,{placeholder:"\u8865\u5145\u63cf\u8ff0(\u9009\u586b)"})),r.a.createElement("div",{className:"optionsWrapper"},a.map((function(e,t){return r.a.createElement(p.a.Item,{key:t},r.a.createElement(f.a,{className:"optionsInput",value:e,placeholder:"\u9009\u9879",onChange:function(e){return c([].concat(Object(j.a)(a.slice(0,t)),[e.target.value],Object(j.a)(a.slice(t+1))))}}),r.a.createElement(E.a,{onClick:function(){return function(e){2!==a.length&&c(a.filter((function(t,a){return a!==e})))}(t)}},"\xd7"))})),r.a.createElement(E.a,{onClick:function(){c([].concat(Object(j.a)(a),[""]))},className:"addOption"},"\u6dfb\u52a0\u9009\u9879")),r.a.createElement(p.a.Item,null,r.a.createElement(I.a,{showTime:!0,onOk:function(e){g(e)},format:"YYYY/MM/DD HH:mm",placeholder:"\u622a\u6b62\u65f6\u95f4",defaultValue:k()()})),r.a.createElement(p.a.Item,null,r.a.createElement(y.a,{onChange:function(e){N(e.target.checked)}},"\u533f\u540d\u6295\u7968")),r.a.createElement(p.a.Item,null,r.a.createElement(E.a,{onClick:function(){return D.apply(this,arguments)},type:"primary"},"\u521b\u5efa"))))}function C(){var e=Object(n.useState)(["",""]),t=Object(o.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)({}),i=Object(o.a)(l,2),u=i[0],g=i[1],v=Object(n.useState)(!1),h=Object(o.a)(v,2),b=h[0],N=h[1],S=Object(s.f)(),C=p.a.useForm(),F=Object(o.a)(C,1)[0];function D(){return(D=Object(w.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:F.getFieldValue("title"),description:F.getFieldValue("description"),options:a,ddl:u._d.toISOString(),anonymous:b?1:0,multiple:1},e.prev=1,e.next=4,m.a.post("/vote/createvote",t);case 4:n=e.sent,d.b.success("\u521b\u5efa\u6210\u529f"),S.push("/vote/".concat(n.data.voteId)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),d.b.warning(e.t0.response.data.msg.toString());case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}return r.a.createElement("div",{className:"wrapper"},r.a.createElement("h3",null,"\u521b\u5efa\u591a\u9009\u6295\u7968"),r.a.createElement(p.a,{form:F,layout:"horizontal"},r.a.createElement(p.a.Item,{name:"title",rules:[{required:!0,message:"\u6295\u7968\u6807\u9898\u5fc5\u586b"}]},r.a.createElement(f.a,{placeholder:"\u6295\u7968\u6807\u9898"})),r.a.createElement(p.a.Item,{name:"description"},r.a.createElement(f.a,{placeholder:"\u8865\u5145\u63cf\u8ff0(\u9009\u586b)"})),r.a.createElement("div",{className:"optionsWrapper"},a.map((function(e,t){return r.a.createElement(p.a.Item,{key:t},r.a.createElement(f.a,{className:"optionsInput",value:e,placeholder:"\u9009\u9879",onChange:function(e){return c([].concat(Object(j.a)(a.slice(0,t)),[e.target.value],Object(j.a)(a.slice(t+1))))}}),r.a.createElement(E.a,{onClick:function(){return function(e){2!==a.length&&c(a.filter((function(t,a){return a!==e})))}(t)}},"\xd7"))})),r.a.createElement(E.a,{onClick:function(){c([].concat(Object(j.a)(a),[""]))},className:"addOption"},"\u6dfb\u52a0\u9009\u9879")),r.a.createElement(p.a.Item,null,r.a.createElement(I.a,{showTime:!0,onOk:function(e){g(e)},format:"YYYY/MM/DD HH:mm",placeholder:"\u622a\u6b62\u65f6\u95f4",defaultValue:k()()})),r.a.createElement(p.a.Item,null,r.a.createElement(y.a,{onChange:function(e){N(e.target.checked)}},"\u533f\u540d\u6295\u7968")),r.a.createElement(p.a.Item,null,r.a.createElement(E.a,{onClick:function(){return D.apply(this,arguments)},type:"primary"},"\u521b\u5efa"))))}a(335);var F=a(98);function D(e){var t=e.userInfo,a=void 0===t?{}:t,c=Object(n.useState)(!0),l=Object(o.a)(c,2),i=l[0],u=l[1],p=Object(n.useState)(null),f=Object(o.a)(p,2),E=f[0],g=f[1],v=Object(n.useState)(null),h=Object(o.a)(v,2),b=h[0],O=h[1],w=Object(s.g)().id;if(Object(n.useEffect)((function(){u(!0),g(null),m.a.get("/vote/vote/".concat(w)).then((function(e){g(e.data),O(e.data.votings),u(!1)}))}),[w]),Object(n.useEffect)((function(){if(E&&Date.now()<new Date(E.ddl).getTime()){var e=new WebSocket("ws://localhost:8080/vote/".concat(w));return e.onmessage=function(e){var t=JSON.parse(e.data);O(t)},function(){return e.close()}}}),[w,E]),i)return r.a.createElement("div",null,"loading...");var I=Object(F.groupBy)(b,"optionId"),N=new Set(b.map((function(e){return e.userId}))).size;return r.a.createElement("div",{className:"wrapper"},r.a.createElement("h2",null,E.title," ",E.multiple?"\u3010\u591a\u9009\u3011":"\u3010\u5355\u9009\u3011"),r.a.createElement("p",null,"  ",E.description),r.a.createElement("ul",{className:"votes"},E.options.map((function(e){var t=I[e.id]||[],n=Boolean(t.find((function(e){return e.userId===a.id})));return r.a.createElement("li",{key:e.id,onClick:function(){return function(e,t){if(Date.now()>new Date(E.ddl).getTime())d.b.warning("\u622a\u6b62\u65f6\u95f4\u5df2\u8fc7\uff0c\u4e0d\u80fd\u6295\u7968\u5566");else{var n={optionId:e,voteId:w,userId:a.id,avatar:a.avatar};E.multiple?t?(Object(F.remove)(b,(function(t){return t.userId===a.id&&t.optionId===e})),O(b)):O([].concat(Object(j.a)(b),[n])):t?(Object(F.remove)(b,(function(e){return e.userId===a.id})),O(b)):(Object(F.remove)(b,(function(e){return e.userId===a.id})),O([].concat(Object(j.a)(b),[n]))),m.a.post("/vote/vote/".concat(w),{optionId:e,cancel:t})}}(e.id,n)}}," ",r.a.createElement(y.a,{checked:n})," ",r.a.createElement("span",{className:"option-text"},e.content)," ",r.a.createElement("strong",null,t.length,"\u7968 ",x(t.length,N),"%"),r.a.createElement("div",{className:"option-ratio",style:{width:x(t.length,N)+"%"}}),r.a.createElement("ul",{className:"avatars"},t.map((function(e){return r.a.createElement("li",{key:e.userId},r.a.createElement("img",{src:e.avatar,className:"avatar",alt:"avatar"}))}))))}))),r.a.createElement("p",null,"\u6295\u7968\u622a\u81f3\uff1a",new Date(E.ddl).toLocaleString()))}function x(e,t){return 0===t?0:(e/t*100).toFixed(2)}var z=a(372),T=a(368),V=a(369),q=(a(336),a(374)),Y=a(375);function M(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)({}),s=Object(o.a)(l,2),u=s[0],p=s[1],f=Object(n.useState)(!1),E=Object(o.a)(f,2),g=E[0],h=E[1],b=Object(n.useState)(""),O=Object(o.a)(b,2),j=O[0],w=O[1];Object(n.useEffect)((function(){m.a.get("/vote/myvote").then((function(e){c(e.data)}))}),[]),Object(n.useEffect)((function(){m.a.get("/vote/userinfo").then((function(e){p(e.data)}))}),[j]);var I=r.a.createElement("div",{className:"uploadButton"},g?r.a.createElement(q.a,null):r.a.createElement(Y.a,null),r.a.createElement("span",{style:{marginTop:8}},"\u4e0a\u4f20\u5934\u50cf"));return r.a.createElement("div",{className:"wrapper"},r.a.createElement(v.a,{className:"user"},r.a.createElement("h2",{className:"userName"},u.name),r.a.createElement(z.a,{size:"large",src:u.avatar}),r.a.createElement(T.a,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,action:"/uploads",beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;t||d.b.error("\u53ea\u80fd\u4e0a\u4f20JPG\u6216PNG\u6587\u4ef6");var a=e.size/1024/1024<2;return a||d.b.error("\u5934\u50cf\u5e94\u5c0f\u4e8e2MB!"),t&&a},onChange:function(e){"uploading"!==e.file.status?"done"===e.file.status&&function(e,t){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.readAsDataURL(e)}(e.file.originFileObj,(function(e){w(e),h(!1)})):h(!0)}},I)),r.a.createElement(v.a,{className:"myVotes"},r.a.createElement(V.b,{header:r.a.createElement("h3",null,"\u6211\u521b\u5efa\u7684\u6295\u7968\uff1a"),itemLayout:"horizontal",dataSource:a,renderItem:function(e){return r.a.createElement(V.b.Item,null,r.a.createElement(V.b.Item.Meta,{title:r.a.createElement(i.b,{to:"/vote/".concat(e.id)},e.title)}))}})))}a(362);var P={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},B={wrapperCol:{xs:{span:24,offset:0},sm:{span:16,offset:8}}};function L(){var e=p.a.useForm(),t=Object(o.a)(e,1)[0],a=Object(s.f)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,Object.assign({form:t,layout:"horizontal",className:"register-form",scrollToFirstError:!0},P),r.a.createElement(p.a.Item,{name:"username",label:"\u7528\u6237\u540d",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",whitespace:!0},function(){return{validator:function(e,t){if(t)return m.a.get("/vote/username-conflict?username=".concat(t)).then((function(e){if(e.data.available)return e.data.msg;throw e.data.msg}))}}}]},r.a.createElement(f.a,null)),r.a.createElement(p.a.Item,{name:"password",label:"\u5bc6\u7801",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",whitespace:!0}]},r.a.createElement(f.a.Password,{visibilityToggle:!1})),r.a.createElement(p.a.Item,{name:"confirm",label:"\u786e\u8ba4\u5bc6\u7801",dependencies:["password"],rules:[{required:!0,message:"\u8bf7\u786e\u8ba4\u5bc6\u7801",whitespace:!0},function(e){var t=e.getFieldValue;return{validator:function(e,a){return a&&t("password")!==a?Promise.reject("\u4e24\u6b21\u8f93\u5165\u4e0d\u4e00\u81f4"):Promise.resolve()}}}]},r.a.createElement(f.a.Password,{visibilityToggle:!1})),r.a.createElement(p.a.Item,{name:"email",label:"\u7535\u5b50\u90ae\u7bb1",rules:[{type:"email",message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u5b50\u90ae\u7bb1\u683c\u5f0f"},{required:!0,message:"\u8bf7\u8f93\u5165\u7535\u5b50\u90ae\u7bb1"},function(){return{validator:function(e,t){if(t)return m.a.get("/vote/email-conflict?email=".concat(t)).then((function(e){if(e.data.available)return e.data.msg;throw e.data.msg}))}}}]},r.a.createElement(f.a,null)),r.a.createElement(p.a.Item,B,r.a.createElement(E.a,{type:"primary",htmlType:"submit",className:"button",onClick:function(e){e.preventDefault(),m.a.post("/vote/signup",t.getFieldsValue(["username","password","email"])).then((function(e){d.b.success(e.data.msg),a.push("/")}),(function(e){d.b.warning(e.response.data.msg.toString()),t.resetFields(["username","password","email"])}))}},"\u6ce8\u518c"))))}var W=function(){var e=Object(s.f)(),t=Object(n.useState)(void 0),a=Object(o.a)(t,2),c=a[0],l=a[1];return Object(n.useEffect)((function(){m.a.get("/vote/userinfo").then((function(e){l(e.data)})).catch((function(t){console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u5c06\u663e\u793a\u767b\u5f55\u754c\u9762"),e.push("/login")}))}),[]),r.a.createElement("div",{className:"App"},r.a.createElement(i.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/login"},r.a.createElement(g,null)),r.a.createElement(s.a,{path:"/",exact:!0},r.a.createElement(h,null)),r.a.createElement(s.a,{path:"/create-single-vote"},r.a.createElement(S,null)),r.a.createElement(s.a,{path:"/create-multiple-vote"},r.a.createElement(C,null)),r.a.createElement(s.a,{path:"/vote/:id"},r.a.createElement(D,{userInfo:c})),r.a.createElement(s.a,{path:"/my"},r.a.createElement(M,null)),r.a.createElement(s.a,{path:"/signup"},r.a.createElement(L,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a,null,r.a.createElement(W,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[192,1,2]]]);
//# sourceMappingURL=main.8de35a4e.chunk.js.map